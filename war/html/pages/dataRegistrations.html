<!DOCTYPE html>

<html lang="en-US">
<head>
	<title>Data Viewer: Registrations | $title</title>
	<meta name="description" content="View the $title registrations">
	<meta name="robots" content="noindex, nofollow">
	<meta name="tab" content="ContestData">
	<meta name="type" content="$type">
	#parse("head.html")
	<style type="text/css">
		.highlighted { background-color: #f5f5f5 !important; }
		.container,
		.navbar-static-top .container,
		.navbar-fixed-top .container,
		.navbar-fixed-bottom .container { width: 1280px; }
		@media print { @page { size: landscape; } }
		.paidComments, .email {
			max-width: 90px;
			white-space: nowrap;
			overflow: hidden;
			text-overflow: ellipsis;
		}
	</style>
	<link type="text/css" href="/css/theme.bootstrap.css" rel="stylesheet">
</head>

<body>
	#parse("navbar.html")
	<div class="container">
		<h1>Contest Data Viewer &amp; Editor #include("printButton.html")</h1>
		
		#if($updated)
		<div class="alert alert-success">
			<a class="close" data-dismiss="alert">&times;</a> <strong>Success! </strong>The changes have been committed
			to the database and are reflected below.
		</div>
		#end
		
		<h2>Recorded Registrations</h2>
		<em>Note:</em> first number indicates number of registrations and second the number of tests actually taken
		<br/><strong>Click a cell to edit its registration</strong>
		<form method="get" class="form-horizontal" action="/editRegistration">
			#if($enabledLevels.contains("middle"))
				<h3>Middle School</h3>
				<table class="table table-striped table-condensed table-hover" id="middleReg">
					<thead>
						<tr>
							<th class="hide"></th>
							<th>Edit</th>
							<th>Name</th>
							<th colspan="2">E-Mail</th>
							<th><abbr title="Registration Type">Reg.</abbr></th>
							<th colspan="2">School</th>
							<th>Payment</th>
							<th><abbr title="Account">Acct.</abbr></th>
							#foreach($test in $Test.middleTests())
								<th colspan="2" class="text-center"><abbr title="$test.getGrade()th $test.getSubject().getName()">$test</abbr></th>
							#end
							<th>Cost</th>
						</tr>
					</thead>
					<tbody>
						#foreach($reg in $middleRegs)
							#if($reg.hasProperty("studentData"))
								<tr data-eid="$reg.getKey().getId()">
									<td class="registrationInfo hide">$reg.getProperty("studentData").getValue()</td>
									<td class="uneditable text-center" title='$dateFormat.format($reg.getProperty("timestamp"))'>
										<span class="hide">$dateFormat.format($reg.getProperty("timestamp"))</span>
										<input type="radio" name="key" value="$reg.getKey().getId()">
									</td>
									<td data-type="name">$reg.getProperty("name")</td>
									<td data-type="email" class="email" style="padding-right: 0px;">$reg.getProperty("email")</td>
									<td class="uneditable" style="padding-left: 0px;">
										<a href='mailto:$reg.getProperty("name")<$reg.getProperty("email")>' target="_blank"><i class="glyphicon glyphicon-envelope"></i></a>
									</td>
									<td data-type="registrationType" class="regType uneditable">$reg.getProperty("registrationType")</td>
									<td data-type="schoolName">$reg.getProperty("schoolName")</td>
									<td data-type="division" class="division uneditable">$reg.getProperty("division")</td>
									<td data-type="paid" class="paidComments">$reg.getProperty("paid")</td> 
									<td class="account uneditable">$reg.getProperty("account")</td>
									
									#foreach($test in $Test.middleTests())
										<td class="test uneditable" data-type="$test.toString().toLowerCase()">
											<a class="popovers" href="#" data-toggle="popover" data-html="true" data-placement="bottom">0</a>
										</td>
										<td class="uneditable">#if($reg.getProperty($test.toString().toUpperCase()))$reg.getProperty($test.toString().toUpperCase())#else 0#end</td>
									#end
									
									<td class="uneditable">&#36;$reg.getProperty("cost")</td>
								</tr>
							#end
						#end 
					</tbody>
					<tfoot> 
						<tr>
							<td></td>
							<td style="font-weight: bold;">Total</td>
							#foreach($i in [1..7]) <td></td> #end
							#foreach($test in $Test.middleTests())
								<td colspan="2" style="font-weight: bold;" data-type="$test.toString().toLowerCase()" class="total">0</td>
							#end
							<td style="font-weight: bold;">$<span class="totalCost">0</span></td>
						</tr>
					</tfoot>
				</table>
				<dl class="dl-horizontal">
					#foreach($subject in $Subject.values())
						<dt>$subject.getName()</dt>
						<dd class="subjectTotal" data-type="$subject">$subject</dd>
					#end
				</dl>
			#end
			
			#if($enabledLevels.contains("high"))
				<h3>High School</h3>
				<table class="table table-striped table-condensed table-hover" id="highReg">
					<thead>
						<tr data-eid="$reg.getKey().getId()">
							<th class="hide"></th>
							<th>Edit</th>
							<th>Name</th>
							<th colspan="2">E-Mail</th>
							<th><abbr title="Registration Type">Reg.</abbr></th>
							<th colspan="2">School</th>
							<th>Payment</th>
							<th><abbr title="Account">Acct.</abbr></th>
							#foreach($test in $Test.highTests())
								<th colspan="2" class="text-center"><abbr title="$test.getGrade()th $test.getSubject().getName()">$test</abbr></th>
							#end
							<th>Cost</th>
						</tr>
					</thead>
					<tbody>
						#foreach($reg in $highRegs)
							#if($reg.hasProperty("studentData"))
								<tr data-eid="$reg.getKey().getId()">
									<td class="registrationInfo hide">$reg.getProperty("studentData").getValue()</td>
									<td class="uneditable text-center" title='$dateFormat.format($reg.getProperty("timestamp"))'>
										<span class="hide">$dateFormat.format($reg.getProperty("timestamp"))</span>
										<input type="radio" name="key" value="$reg.getKey().getId()">
									</td>
									<td data-type="name">$reg.getProperty("name")</td>
									<td data-type="email" class="email" style="padding-right: 0px;">$reg.getProperty("email")</td>
									<td class="uneditable" style="padding-left: 0px;">
										<a href='mailto:$reg.getProperty("name")<$reg.getProperty("email")>' target="_blank"><i class="glyphicon glyphicon-envelope"></i></a>
									</td>
									<td data-type="registrationType" class="regType uneditable">$reg.getProperty("registrationType")</td>
									<td data-type="schoolName">$reg.getProperty("schoolName")</td>
									<td data-type="division" class="division uneditable">$reg.getProperty("division")</td>
									<td data-type="paid" class="paidComments">$reg.getProperty("paid")</td> 
									<td class="account uneditable">$reg.getProperty("account")</td>
									
									#foreach($test in $Test.highTests())
										<td class="test uneditable" data-type="$test.toString().toLowerCase()">
											<a class="popovers" href="#" data-toggle="popover" data-html="true" data-placement="bottom">0</a>
										</td>
										<td class="uneditable">#if($reg.getProperty($test.toUpperCase()))$reg.getProperty($test.toUpperCase())#else 0#end</td>
									#end
									
									<td class="uneditable">&#36;$reg.getProperty("cost")</td>
								</tr>
							#end
						#end
					</tbody>
					<tfoot>
						<tr>
							<td></td>
							<td style="font-weight: bold;">Total</td>
							#foreach($i in [1..7]) <td></td> #end
							#foreach($test in $Test.highTests())
								<td colspan="2" style="font-weight: bold;" data-type="$test.toString().toLowerCase()" class="total">0</td>
							#end
							<td style="font-weight: bold;">$<span class="totalCost">0</span></td>
						</tr>
					</tfoot>
				</table>
				<dl class="dl-horizontal">
					#foreach($subject in $Subject.values())
						<dt>$subject.getName()</dt>
						<dd class="subjectTotal" data-type="$subject">$subject</dd>
					#end
				</dl>
			#end
		
			<input type="hidden" id="price" value="$price">
		
			<div class="form-group">
  				<div class="col-sm-12">
					<button type="submit" id="submit" class="btn btn-primary"><i class="icon-edit"></i> Edit Selected</button>
					<span class="lead">Individual registration editing interface</span>
				</div>
			</div>
		</form>
	</div>

	<script type="text/javascript" src="/js/jquery/jquery.jeditable.mini.js"></script>
	<script type="text/javascript" src="/js/jquery/jquery.tablesorter.min.js"></script>
	<script type="text/javascript" src="/js/jquery/jquery.tablesorter.widgets.min.js"></script>
	<script type="text/javascript" src="/js/pagescripts/data-registrations.js"></script>
	#include("noscript.html")
</body>
</html>