<h2><a class="anchor" id="visualizations"></a>Visualizations</h2>

<div class="panel-group" id="accordion">
	#foreach($subject in $subjects)
   		#set($title = $subject.getName().concat(" Comparison"))
        	
		<div class="panel panel-default">
			<div class="panel-heading">
				<a class="panel-title" data-toggle="collapse" data-parent="#accordion" href="#collapse${subject}"> $title</a>
			</div>
			<div id="collapse$subject" class="panel-collapse collapse #if($foreach.first) in #end">
				<div class="panel-body">
					<div id="${subject}-graph" class="scoreGraph" style="min-width: 60%"></div>
				</div>
			</div>
		</div>
	#end
</div>

<div style="padding-top: 10px;">
	Outliers computed using <a href="https://en.wikipedia.org/wiki/Chauvenet's_criterion" target="_blank">Chauvenet's Criterion for Outliers</a>
	with assumptions of Gaussian normality for sample populations of over 5 scores.
</div>


#set($minGrade = 1000)
#foreach($test in $tests)
	#if($summaryStats[$test]) <div id="$test" class="hide">$summaryStats[$test]</div> #end
	#if($test.grade() < $minGrade)
		#set($minGrade = $test.grade())
	#end
#end

<script type="text/javascript">
	$(document).ready(function () {
		#foreach($subject in $subjects)
			#set($title = $subject.getName().concat(" Scores"))

        	#set($outlierList = [])
        	#foreach($test in $tests)
        		#if($test.test() == $subject)
	        		#foreach($outlier in $outliers[$test])
	        			#set($marker = $test.grade() - $minGrade)
	        			#set($outlierString = "[" + $marker + "," + $outlier + "]")
	        			#set($dummy = $outlierList.add($outlierString))
	        		#end
        		#end
        	#end
        	
			$('#${subject}-graph').highcharts({
			    chart: {
			        type: 'boxplot',
		            inverted: true,
		            width: $('.collapse.in').width() * .95
			    },
			    title: {
			        text: '$title'
			    },
			    legend: {
			        enabled: false
			    },
			    xAxis: {
			    	#if($level == "middle")
			        	categories: ['6', '7', '8'],
			        #else
			        	categories: ['9', '10', '11', '12'],
			        #end
			        title: {
			            text: 'Grade'
			        }
			    },
			    yAxis: {
			        title: {
			            text: 'Score'
			        }	 
			    },
			
			    series: [{
			        name: 'Score',
			        data: [
						#if($level == "middle")   
			            	$.parseJSON($('#6${subject}').html()),
			            	$.parseJSON($('#7${subject}').html()),
			           		$.parseJSON($('#8${subject}').html())
			           	#else
			           		$.parseJSON($('#9${subject}').html()),
			            	$.parseJSON($('#10${subject}').html()),
			           		$.parseJSON($('#11${subject}').html()),
			           		$.parseJSON($('#12${subject}').html())
			            #end
			        ],
			        tooltip: {
			            headerFormat: '<em>Grade {point.key}</em><br/>'
			        }
			    },{
			        name: 'Outlier',
			        color: Highcharts.getOptions().colors[0],
			        type: 'scatter',
			        data: [
			            #foreach($outlier in $outlierList)
			            	$outlier#if(!$foreach.last),#end
			            #end
			        ],
			        marker: {
			            fillColor: 'white',
			            lineWidth: 1,
			            lineColor: Highcharts.getOptions().colors[0]
			        },
			        tooltip: {
			            pointFormat: 'Score: {point.y}'
			        }
			    }]
			});
		#end
	});
	
	$(window).resize(function() {
		$('.scoreGraph').setSize($('.collapse.in').width() * .95, 500);       
	});
</script>